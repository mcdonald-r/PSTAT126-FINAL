---
title: "PSTAT126-FINAL"
output:
  pdf_document: null
  latex_engine: xelatex
  html_document:
    df_print: paged
---

``` {r, echo = F, message = F}
library(skimr)
library(dplyr)
library(ggplot2)
```
## PART - 1 Data Description and Descriptive Statistics

### Description of Variables and Observational Unit 

The **Color** variable is a color grading scale that ranges from D to H (in the data set) and rates the colorless or
near colorless of a white diamond. Diamonds in the ranges of D to F are the best that contain no other color and are
of the highest quality. Diamonds in the ranges of G to J are still high quality but contain slight traces of color.

The **Clarity** variable rates the presence of internal or external blemishes, known as inclusions within the
diamond. In the data set the ratings go from VVS2, VS1, VS2, SI1, SI2. VVS2 means that inclusions are very difficult
to see under 10x magnification. VS means that inclusions are difficult to see under 10x magnification. VS2 means
that inclusions are somewhat easier to see under 10x magnification, but still minor. SI1 means that inclusions are
noticeable under 10x magnification. SI2 means that inclusions are more easily noticeable under 10x magnification.

The **Price** variable determines the monetary value of a diamond. There are a lot of factors that go into
determining the value of a diamond like cut, clarity, color, shape, and many more. 

The **Table** of a diamond refers to the large flat face when looking down at the top of the diamond. In the data
set the variable is a percentage of how big the table is compared to the total diameter of the diamond.

The **Depth** of a diamond is the distance from the large flat surface of the top of the diamond, known as the
table, to the bottom of the diamond, known as the culet. In the data set the variable is a percentage of how deep a
diamond in relation to its width. 

The **Observational Unit** of the data set is a single diamond out of the total 54,000 diamonds that make up the data
set. Each contain the variables stated before as well as 6 other variables that are outside the scope of this
project.

### Summary of The Data

``` {r Part 1.0, echo = T, results = T}
dataset <- read.csv("/users/robeh/desktop/DiamondsPrices2022.csv")
set.seed(1)
diamonds_subset <- sample_n(dataset, 500)

table(diamonds_subset$color)
prop.table(table(diamonds_subset$color))
table(diamonds_subset$clarity)
prop.table(table(diamonds_subset$clarity))

summary(diamonds_subset$price)
summary(diamonds_subset$table)
summary(diamonds_subset$depth)
```

The summary statistics you see come form a subset of the Diamonds data set, which we created by taking at random 500
observations to create this subset, we can see the summaries of the 5 variables that are within the scope of the
experiment being conducted.

Looking at the variable **Color** we see that it's divided into 7 categories that represent the diamond's rating for
color. The rating **G** has the most with 109 diamonds with that rating whereas the rating **I** has the least amount
of diamonds at just 35. Looking at it from a percentage point of view, since there are 7 categories and if they were evenly distributed among the categories, each would have about 14.3%, which most of the categories are close to.

On to the second categorical variable, **Clarity** the data shows out of the 8 categories the 2 with the most
observations were **VS2** and **SI1** which respectively had 121 and 120 of the observations. The category with least 
observations by far was **I1** which had a total of 6 observations. If the observations were perfectly distributed
among the 8 categories they would each have 12.5%, however in this summary we see that many are far off from that 
percentage and vary a lot.

Moving onto **Price**, the mean price of a diamond was \$4,249 with the minimum price and maximum price being \$362 and 
\$18,757 respectively. When it comes to the quartiles 25% of the diamonds were under \$917, half of the diamonds were
under \$2,657 and 75% of the diamonds were under \$5374. Looking at these results we see how the mean and median are
around \$2,400 off from each other, meaning that there were a few numbers that were very high skewing the average. This
is shown even more when you look at the 75% quartile and there is over a \$13,000 difference between them. 

Looking at the **Table** variable which are percentages in the data set, it shows that the mean is 57.37% and the 
minimum and maximum of the table of the diamond is 52% and 66%. With the median being very close to the average sitting
at exactly 57% we know that there aren't to many far off table observations. However, looking at the difference of the 
maximum percent and the 75% quartile there is 7% difference which is a lot, considering that the total dispersion
from the minimum and maximum is 14% which makes the 7% difference half of the whole dispersion. 

Lastly, the **Depth** which are also percentages in the data set. The summary shows that the mean is 61.87% and the 
minimum and maximum percentages are 56.9% and 70.2% respectively. When it comes to the quartiles, 25% of the depths are
under 56%, half of the depths are under 61.9%, and 75% of the depths are under 62.6%. Something interesting to note is that similarly to the **Table** variable, the difference between the max value and 75% quartile value was 7.6% which is
actually more than half of the difference between the minimum and maximum value which was 13.3%. 

## Examining Relationships

``` {r Part 1.1, echo = F, results = T, fig.width=6, fig.height=3}
table(diamonds_subset$color, diamonds_subset$clarity)

ggplot(diamonds_subset, aes(x = table, y = price)) + geom_point() + labs(title = "Comparing Price($) and Table(%)", x = "Table(%)", y = "Price($)") 

ggplot(diamonds_subset, aes(x = depth, y = price)) + geom_point() + labs(title = "Comparing Price($) and Depth(%)", x = "Depth(%)", y = "Price($)") 

```

Enter the relationship information here 

``` {r Part 1.2, echo = F, results = F}
set.seed(2)
diamonds_subset_2 <- sample_n(dataset, 500) 

table(diamonds_subset_2$color)
table(diamonds_subset_2$clarity)
summary(diamonds_subset_2$price)
summary(diamonds_subset_2$table)
summary(diamonds_subset_2$depth)
```

``` {r Part 1.3, echo = F, results = F}
set.seed(3)
diamonds_subset_3 <- sample_n(dataset, 500)

table(diamonds_subset_3$color)
table(diamonds_subset_3$clarity)
summary(diamonds_subset_3$price)
summary(diamonds_subset_3$table)
summary(diamonds_subset_3$depth)
```

## Part 2 - Simple Linear Regression

### Addressing The Hypothesis

From comparing the variables that I decided to keep the scope of the experiment on, I realized that there wasn't much 
correlation between them. Before the experiment I choose the variables to use at random, just to see what would happen.
However, there wasn't much correlation and after looking at the linear models that I made I decided to also look into
another relationship. That's when I decided it could be interesting to look at the relationships between how a diamond's
length (in millimeters) would affect its price. For both of these experiments my hypothesis is that the variables are
both positively linear related. For more context, I will describe these new variable I've added to the overall
experiment.

``` {r Part 2.0, echo = T, results = T}
summary(diamonds_subset$x)

# table(diamonds_subset$x)
```

The **x** variable measures the length of diamond which are taken in millimeters. A summary report shows how the average
diamond length is 5.79mm as its min is 0mm and its max is 10.74mm. It's important to note that the minimum value for
the variable is 0 which shouldn't be the case. Further looking into it there was only a count of one 0 value in
the **x** variable, so I've elected to keep it as an outlier in the data set, because there are also some outliers in
the top end of the values.

```{r Part 2, echo = T, results = T, fig.width=6, fig.height=4}
fit1 <- lm(price ~ x, data = diamonds_subset)
summary(fit1)

plot(diamonds_subset$x, diamonds_subset$price, xlab="Length(mm)", ylab="Price($)")
abline(fit1,col='red')

par(mfrow=c(2,2))
plot(fit1)
```

Looking into the residuals of the summary of the linear regression model we can see that the mean is -396.3 which is 
relatively small in the scale of the variable. Further looking into the residuals we can see that the min and max values
are very far apart, the min being -3792.9 and the max being 29066.4, this brings up the outliers we mentioned earlier
and how they would've played a role when it came to these values. Overall the mean showed a pretty good prediction of
the price. Looking at the coefficients I can immediately see the p-values of both the intercept and the slope, both are
are extremely low numbers and the significant codes show that there is a very high significance of the relationship
between the price and length of the diamond. Moving onto the last of the statistics, the model shows that average 
residual error was 2289 which isn't the worst considering the lowest price value was 362 and the highest was 18757. The
R-squared value shows a 72.31% variability of price is due to the length, which confirms the data that we've been 
looking at. Lastly, the final confirmation of the strong correlation is that the F statistic is very high, overall the 
summary statistics shows that there is very strong significance in the length of the diamond affecting its price. 

Moving onto the graphs the first graph really shows how well the model fits the given data. Between the length of 2mm
and around 7mm we see where most of the data lies and hugs that red model line. As the price gets larger we can see 
some observations stray from the model, which can do with there being less observations that are such high prices and 
may also take into account other variables that can affect the price like how well the clarity and color is of those 
respective diamonds. In the rest of the diagnostic plots the observations are for the most part right alone the lines
of the model. One important thing to not from these plots is the emergence of two outliers. There is one label 130 that
can be seen pretty apparently and another unlabeled open that show up in all 4 plots. While there are only two of these
outliers they are still important to note and show that even within a sample size of 500 observatiosn the presence of 
outliers is there. 

```{r Part 2.1, echo = T, results = T, fig.width=6, fig.height=4}
fit2 <- lm(price ~ table, data = diamonds_subset)
summary(fit2)

par(mfrow=c(2,2))
plot(fit2)

# Transform the data
fit2_logy <- lm(log(price) ~ table, data = diamonds_subset)
summary(fit2_logy)
plot(fit2_logy)
```

For the second model I decided to test I wanted to look into transforming the linear model in order to see how much 
better the predictions would be or if it wouldn't matter in this case. 







